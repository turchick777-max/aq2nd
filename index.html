<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AQUINTAQA - How It Works</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      background-color: #F4F7FA;
    }

    :root {
      /* Variant B — LOCKED */
      --bg: #F4F7FA;
      /* grid */
      --grid-minor: rgba(15, 23, 42, 0.055);
      --grid-major: rgba(15, 23, 42, 0.085);
      /* frame/panels */
      --frame: rgba(15, 23, 42, 0.18);
      --frame2: rgba(15, 23, 42, 0.12);
      --paper: rgba(255,255,255,0.72);
      /* typography */
      --text: rgba(15,23,42,0.90);
      --muted: rgba(71,85,105,0.90);
      --muted2: rgba(71,85,105,0.75);
      /* accent / modules */
      --accent: #009EBA;
      --core-fill: #D4F1F6;
      --cots-fill: #FFFFFF;
      --cots-stroke: rgba(15,23,42,0.22);
      /* streams */
      --stream: rgba(71,85,105,0.65);
      --stream-dash: rgba(71,85,105,0.45);
      /* concentrate */
      --conc: #D28437;
      --conc-fill: #FCF0E5;
      --shadow: 0 18px 50px rgba(15,23,42,0.08);
      --radius: 18px;
    }

    /* ===== Screen container with double grid ===== */
    .hiw {
      padding: 40px 20px;
      background:
        linear-gradient(var(--grid-minor) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-minor) 1px, transparent 1px),
        linear-gradient(var(--grid-major) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-major) 1px, transparent 1px);
      background-color: var(--bg);
      background-size: 32px 32px, 32px 32px, 160px 160px, 160px 160px;
    }

    .hiw__sheet {
      position: relative;
      margin: 0 auto;
      max-width: 1320px;
      background: transparent;
      border-radius: 22px;
      padding: 26px;
    }

    /* ===== CAD frame ===== */
    .hiw__frame {
      position: absolute;
      inset: 18px;
      border: 2px solid var(--frame);
      border-radius: 20px;
      pointer-events: none;
    }

    .hiw__frame::after {
      content: "";
      position: absolute;
      inset: 10px;
      border: 1px solid var(--frame2);
      border-radius: 16px;
    }

    .hiw__corner {
      position: absolute;
      width: 18px;
      height: 18px;
      border-color: var(--frame);
    }

    .hiw__corner.tl {
      top: -2px;
      left: -2px;
      border-left: 3px solid var(--frame);
      border-top: 3px solid var(--frame);
      border-top-left-radius: 6px;
    }

    .hiw__corner.tr {
      top: -2px;
      right: -2px;
      border-right: 3px solid var(--frame);
      border-top: 3px solid var(--frame);
      border-top-right-radius: 6px;
    }

    .hiw__corner.bl {
      bottom: -2px;
      left: -2px;
      border-left: 3px solid var(--frame);
      border-bottom: 3px solid var(--frame);
      border-bottom-left-radius: 6px;
    }

    .hiw__corner.br {
      bottom: -2px;
      right: -2px;
      border-right: 3px solid var(--frame);
      border-bottom: 3px solid var(--frame);
      border-bottom-right-radius: 6px;
    }

    /* ===== Header ===== */
    .hiw__header {
      padding: 8px 10px 18px;
      text-align: center;
    }

    .hiw__title {
      margin: 0;
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
      font-size: 28px;
      font-weight: 600;
      line-height: 1.1;
      letter-spacing: 0.32em;
      color: rgba(15, 23, 42, 0.62);
    }

    /* ===== Main layout ===== */
    .hiw__main {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 22px;
      align-items: stretch;
      margin-bottom: 18px;
    }

    /* ===== Stepper ===== */
    .hiw__stepper {
      border: 1px solid rgba(15, 23, 42, 0.14);
      border-radius: 18px;
      background: var(--paper);
      box-shadow: var(--shadow);
      padding: 18px 16px;
      position: relative;
      overflow: hidden;
    }

    .hiw__stepper::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 158, 186, 0.08), transparent 40%);
      pointer-events: none;
    }

    .hiw__steps {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 10px;
      border-radius: 14px;
      color: var(--muted);
      border: 1px solid transparent;
      transition: all 250ms ease;
    }

    .step__dot {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 2px solid rgba(100, 116, 139, 0.40);
      background: rgba(255, 255, 255, 0.75);
      display: grid;
      place-items: center;
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 600;
      line-height: 1;
      color: rgba(100, 116, 139, 0.85);
      flex: 0 0 auto;
      transition: all 250ms ease;
    }

    .step__label {
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      line-height: 1.2;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .step.is-active {
      border-color: rgba(0, 158, 186, 0.35);
      background: rgba(0, 158, 186, 0.08);
      color: var(--text);
    }

    .step.is-active .step__dot {
      border-color: rgba(0, 158, 186, 0.65);
      color: rgba(0, 158, 186, 0.95);
      background: rgba(212, 241, 246, 0.95);
    }

    /* ===== Diagram ===== */
    .hiw__diagram {
      position: relative;
      border: 1px solid rgba(15, 23, 42, 0.14);
      border-radius: 18px;
      background: rgba(255, 255, 255, 0.35);
      box-shadow: var(--shadow);
      overflow: hidden;
      min-height: 560px;
    }

    .hiw__watermark {
      position: absolute;
      inset: 0;
      opacity: 0.06;
      background-image:
        radial-gradient(circle at 20% 30%, rgba(0, 158, 186, 0.25) 0 2px, transparent 3px),
        linear-gradient(30deg, rgba(100, 116, 139, 0.22), transparent 55%),
        linear-gradient(140deg, rgba(100, 116, 139, 0.18), transparent 60%);
      pointer-events: none;
      mix-blend-mode: multiply;
    }

    .hiw__svg {
      width: 100%;
      height: 100%;
      display: block;
      padding: 14px;
    }

    /* ===== SVG styling ===== */
    .svgLabel {
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      fill: rgba(15, 23, 42, 0.70);
    }

    .svgSubLabel {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 400;
      fill: rgba(71, 85, 105, 0.78);
    }

    .svgCalloutBox {
      fill: rgba(255, 255, 255, 0.72);
      stroke: rgba(186, 198, 211, 0.75);
      stroke-width: 2;
    }

    .svgCalloutText {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 600;
      fill: rgba(15, 23, 42, 0.70);
    }

    .moduleBox {
      stroke-width: 3;
      paint-order: stroke fill;
      transition: all 350ms ease;
    }

    .module .moduleTitle {
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 700;
      fill: rgba(15, 23, 42, 0.82);
      letter-spacing: 0.08em;
    }

    .module .moduleSub {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 500;
      fill: rgba(71, 85, 105, 0.86);
    }

    /* Core modules */
    .module.core .moduleBox {
      fill: var(--core-fill);
      stroke: rgba(0, 158, 186, 0.85);
    }

    /* COTS modules */
    .module.cots .moduleBox {
      fill: var(--cots-fill);
      stroke: var(--cots-stroke);
    }

    /* Product (still a module) */
    .module.product .moduleBox {
      fill: rgba(212, 241, 246, 0.85);
      stroke: rgba(0, 158, 186, 0.75);
    }

    /* Concentrate (stream box) */
    .module.concentrate .moduleBox {
      fill: var(--conc-fill);
      stroke: rgba(210, 132, 55, 0.95);
    }

    .module.concentrate .moduleTitle {
      fill: rgba(146, 64, 14, 0.92);
    }

    .module.concentrate .moduleSub {
      fill: rgba(146, 64, 14, 0.78);
    }

    .stream {
      fill: none;
      stroke: var(--stream);
      stroke-width: 4;
      transition: all 300ms ease;
    }

    .stream.dashed {
      stroke-dasharray: 10 8;
      stroke: var(--stream-dash);
    }

    .stream.accent {
      stroke: var(--accent);
      stroke-width: 5;
    }

    .stream.concentrateStream {
      stroke: rgba(210, 132, 55, 0.92);
    }

    .coreBoundary {
      fill: transparent;
      stroke: rgba(0, 158, 186, 0.18);
      stroke-width: 3;
      stroke-dasharray: 12 10;
    }

    /* Active highlight (module pulse, subtle) */
    .module.is-active .moduleBox {
      stroke: rgba(0, 158, 186, 1);
      stroke-width: 4;
    }

    /* ===== Footer panel ===== */
    .hiw__footer {
      border-top: 1px solid rgba(15, 23, 42, 0.14);
      padding-top: 18px;
    }

    .hiw__footerGrid {
      display: grid;
      grid-template-columns: 320px 1fr 400px;
      gap: 18px;
      align-items: stretch;
    }

    .hiw__footerStages,
    .hiw__footerDetail,
    .hiw__footerLegend {
      border: 1px solid rgba(15, 23, 42, 0.14);
      border-radius: 18px;
      background: var(--paper);
      box-shadow: var(--shadow);
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    .hiw__footerSteps {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .fstep {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid transparent;
      color: var(--muted);
      transition: all 250ms ease;
    }

    .fstep__idx {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 2px solid rgba(100, 116, 139, 0.35);
      display: grid;
      place-items: center;
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 700;
      color: rgba(100, 116, 139, 0.90);
      background: rgba(255, 255, 255, 0.70);
      transition: all 250ms ease;
    }

    .fstep__label {
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: rgba(15, 23, 42, 0.82);
    }

    .fstep.is-active {
      background: rgba(0, 158, 186, 0.08);
      border-color: rgba(0, 158, 186, 0.35);
    }

    .fstep.is-active .fstep__idx {
      border-color: rgba(0, 158, 186, 0.65);
      background: rgba(212, 241, 246, 0.95);
      color: rgba(0, 158, 186, 0.95);
    }

    .hiw__detailKicker {
      display: inline-block;
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.14em;
      color: rgba(71, 85, 105, 0.80);
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .hiw__detailTitle {
      margin: 0 0 10px 0;
      font-family: 'Inter', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: rgba(15, 23, 42, 0.88);
    }

    .hiw__detailText {
      margin: 0;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 400;
      line-height: 1.55;
      color: rgba(71, 85, 105, 0.92);
      max-width: 70ch;
    }

    .hiw__titleBlock {
      margin-top: 14px;
      border-top: 1px dashed rgba(186, 198, 211, 0.8);
      padding-top: 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 14px;
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 500;
      color: rgba(71, 85, 105, 0.85);
    }

    .mono {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      letter-spacing: 0.06em;
    }

    .hiw__legendTitle {
      font-family: 'JetBrains Mono', ui-monospace, monospace;
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.18em;
      color: rgba(15, 23, 42, 0.72);
      margin-bottom: 10px;
    }

    .hiw__legendRow {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      padding: 10px 0;
      border-top: 1px solid rgba(206, 216, 226, 0.55);
    }

    .hiw__legendRow:first-of-type {
      border-top: 0;
      padding-top: 0;
    }

    .hiw__swatch {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 2px solid rgba(186, 198, 211, 0.90);
      flex: 0 0 auto;
      margin-top: 2px;
      background: #fff;
    }

    .hiw__swatch.core {
      background: var(--core-fill);
      border-color: rgba(0, 158, 186, 0.80);
    }

    .hiw__swatch.cots {
      background: #fff;
      border-color: rgba(186, 198, 211, 0.90);
    }

    .hiw__legendLine {
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.35;
      color: rgba(15, 23, 42, 0.86);
    }

    .muted {
      color: rgba(71, 85, 105, 0.76);
    }

    .hiw__note {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(206, 216, 226, 0.55);
    }

    .hiw__noteTitle {
      font-family: 'Inter', sans-serif;
      font-size: 12px;
      font-weight: 700;
      color: rgba(15, 23, 42, 0.72);
      margin-bottom: 4px;
    }

    .hiw__noteText {
      font-family: 'Inter', sans-serif;
      font-size: 12.5px;
      font-weight: 400;
      line-height: 1.45;
      color: rgba(71, 85, 105, 0.88);
    }

    .hiw__noteStrong {
      display: block;
      margin-top: 6px;
      font-weight: 700;
      color: rgba(15, 23, 42, 0.78);
    }

    /* ===== Responsive ===== */
    @media (max-width: 1100px) {
      .hiw__main {
        grid-template-columns: 1fr;
      }
      .hiw__footerGrid {
        grid-template-columns: 1fr;
      }
      .hiw__diagram {
        min-height: 420px;
      }
    }
  </style>
</head>
<body>
  <section id="how-it-works" class="hiw" aria-label="How it works">
    <div class="hiw__sheet">
      <!-- CAD frame + corners -->
      <div class="hiw__frame" aria-hidden="true">
        <span class="hiw__corner tl"></span>
        <span class="hiw__corner tr"></span>
        <span class="hiw__corner bl"></span>
        <span class="hiw__corner br"></span>
      </div>

      <!-- Title -->
      <header class="hiw__header">
        <h2 class="hiw__title">HOW IT WORKS</h2>
      </header>

      <!-- Main: Stepper + Diagram -->
      <div class="hiw__main">
        <!-- Left stepper -->
        <nav class="hiw__stepper" aria-label="Process stages">
          <ol class="hiw__steps" id="hiwSteps"></ol>
        </nav>

        <!-- Diagram area -->
        <div class="hiw__diagram" role="img" aria-label="AQUINTAQA process flow diagram">
          <!-- Watermark (very subtle) -->
          <div class="hiw__watermark" aria-hidden="true"></div>

          <!-- Inline SVG diagram -->
          <svg
            class="hiw__svg"
            viewBox="0 0 980 520"
            xmlns="http://www.w3.org/2000/svg"
          >
            <!-- Streams (keep neutral; colour coding applies to MODULES only) -->
            <defs>
              <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--stream)" />
              </marker>
              <marker id="arrowAccent" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--accent)" />
              </marker>
              <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="8" stdDeviation="10" flood-color="rgba(15,23,42,0.10)" />
              </filter>
            </defs>

            <!-- FEED label -->
            <text x="70" y="120" class="svgLabel">Feed Water</text>
            <text x="70" y="145" class="svgSubLabel">(Seawater / Brackish)</text>

            <!-- Inert gas label (stream label, not module) -->
            <g id="labelGas" class="svgCallout">
              <rect x="420" y="35" width="190" height="52" rx="10" ry="10" class="svgCalloutBox"/>
              <text x="515" y="60" text-anchor="middle" class="svgCalloutText">Inert gas + Sorbent</text>
            </g>

            <!-- Modules (rects) -->
            <!-- Intake -->
            <g id="m-intake" class="module cots" filter="url(#softShadow)">
              <rect x="210" y="95" width="170" height="78" rx="14" class="moduleBox"/>
              <text x="295" y="125" text-anchor="middle" class="moduleTitle">INTAKE</text>
              <text x="295" y="150" text-anchor="middle" class="moduleSub">&amp; Stabilization</text>
            </g>

            <!-- Gas-Sorbent Dosing (core) -->
            <g id="m-dosing" class="module core" filter="url(#softShadow)">
              <rect x="430" y="95" width="200" height="78" rx="14" class="moduleBox"/>
              <text x="530" y="125" text-anchor="middle" class="moduleTitle">GAS-SORBENT</text>
              <text x="530" y="150" text-anchor="middle" class="moduleSub">Dosing</text>
            </g>

            <!-- Sorption (core) -->
            <g id="m-sorption" class="module core" filter="url(#softShadow)">
              <rect x="690" y="205" width="200" height="78" rx="14" class="moduleBox"/>
              <text x="790" y="235" text-anchor="middle" class="moduleTitle">SORPTION</text>
              <text x="790" y="260" text-anchor="middle" class="moduleSub">(Contactor)</text>
            </g>

            <!-- Separation (core) -->
            <g id="m-separation" class="module core" filter="url(#softShadow)">
              <rect x="610" y="315" width="200" height="78" rx="14" class="moduleBox"/>
              <text x="710" y="345" text-anchor="middle" class="moduleTitle">SEPARATION</text>
              <text x="710" y="370" text-anchor="middle" class="moduleSub">(Phase split)</text>
            </g>

            <!-- Mineralization & Polishing (COTS) -->
            <g id="m-polishing" class="module cots" filter="url(#softShadow)">
              <rect x="820" y="315" width="200" height="78" rx="14" class="moduleBox"/>
              <text x="920" y="345" text-anchor="middle" class="moduleTitle">POLISHING</text>
              <text x="920" y="370" text-anchor="middle" class="moduleSub">&amp; Mineral.</text>
            </g>

            <!-- Drinking water (output) -->
            <g id="m-product" class="module core product" filter="url(#softShadow)">
              <rect x="860" y="420" width="160" height="70" rx="14" class="moduleBox"/>
              <text x="940" y="450" text-anchor="middle" class="moduleTitle">DRINKING</text>
              <text x="940" y="475" text-anchor="middle" class="moduleSub">Water</text>
            </g>

            <!-- Concentrate (stream box, NOT core) -->
            <g id="m-concentrate" class="module concentrate" filter="url(#softShadow)">
              <rect x="360" y="420" width="190" height="70" rx="14" class="moduleBox"/>
              <text x="455" y="450" text-anchor="middle" class="moduleTitle">CONCENTRATE</text>
              <text x="455" y="475" text-anchor="middle" class="moduleSub">&lt;5% flow</text>
            </g>

            <!-- Streams -->
            <!-- Feed -> Intake -->
            <path id="s-feed" d="M 140 130 L 210 130" class="stream dashed" marker-end="url(#arrow)"/>

            <!-- Intake -> Dosing -->
            <path id="s-intake" d="M 380 134 L 430 134" class="stream" marker-end="url(#arrow)"/>

            <!-- Gas label -> Dosing (vertical) -->
            <path id="s-gas" d="M 515 87 L 515 95" class="stream dashed" marker-end="url(#arrow)"/>

            <!-- Dosing -> Sorption -->
            <path id="s-dosing" d="M 630 134 L 690 244" class="stream accent" marker-end="url(#arrowAccent)"/>

            <!-- Sorption -> Separation -->
            <path id="s-sorption" d="M 790 283 L 710 315" class="stream accent" marker-end="url(#arrowAccent)"/>

            <!-- Separation -> Polishing -->
            <path id="s-sep2pol" d="M 810 354 L 820 354" class="stream dashed" marker-end="url(#arrow)"/>

            <!-- Polishing -> Product -->
            <path id="s-pol2prod" d="M 900 393 L 940 420" class="stream dashed" marker-end="url(#arrow)"/>

            <!-- Separation -> Concentrate -->
            <path id="s-conc" d="M 610 354 L 550 354 L 550 455" class="stream concentrateStream dashed" marker-end="url(#arrow)"/>

            <!-- Small "core boundary" bracket (visual hint; optional) -->
            <rect x="418" y="80" width="485" height="330" rx="18" class="coreBoundary" />
          </svg>
        </div>
      </div>

      <!-- Footer panel: stages + detail + legend -->
      <footer class="hiw__footer">
        <div class="hiw__footerGrid">
          <div class="hiw__footerStages">
            <ol class="hiw__footerSteps" id="hiwFooterSteps"></ol>
          </div>

          <div class="hiw__footerDetail">
            <div class="hiw__detailHeader">
              <span class="hiw__detailKicker" id="hiwDetailKicker">Stage 1</span>
              <h3 class="hiw__detailTitle" id="hiwDetailTitle">Intake &amp; Stabilization</h3>
            </div>
            <p class="hiw__detailText" id="hiwDetailText"></p>

            <!-- Mini title block (engineering sheet vibe) -->
            <div class="hiw__titleBlock" aria-hidden="true">
              <div><span class="mono">FIG</span> 3-1</div>
              <div><span class="mono">DOC</span> AQU-HIW</div>
              <div><span class="mono">REV</span> 1.0</div>
              <div><span class="mono">DATE</span> <span id="hiwDate"></span></div>
            </div>
          </div>

          <div class="hiw__footerLegend">
            <div class="hiw__legendTitle">LEGEND</div>
            <div class="hiw__legendRow">
              <span class="hiw__swatch core"></span>
              <div>
                <div class="hiw__legendLine">
                  AQUINTAQA core module boundary <span class="muted">(encapsulated/protected)</span>
                </div>
              </div>
            </div>
            <div class="hiw__legendRow">
              <span class="hiw__swatch cots"></span>
              <div class="hiw__legendLine">
                COTS-based auxiliary systems <span class="muted">(intake, utilities, polishing, controls)</span>
              </div>
            </div>

            <!-- Legend v2 — 3rd line (ironclad) -->
            <div class="hiw__note">
              <div class="hiw__noteTitle">Note:</div>
              <div class="hiw__noteText">
                Sensitive setpoints, materials, and core control logic are disclosed stepwise under NDA.
                <span class="hiw__noteStrong">Colour coding applies to modules only, not to streams.</span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </section>

  <script>
    (function(){
      const ENABLE_CLICKS = false; // <- set true if you want to enable clicks on stages
      const AUTOPLAY = true; // auto-advance stages
      const AUTOPLAY_MS = 4000; // 4 sec/stage (recommended 4-6s)

      const stages = [
        {
          id: "intake",
          label: "INTAKE",
          title: "Intake & Stabilization",
          detail: "Intake of seawater / brackish water. Coarse protection against debris and flow stabilization. No heavy pre-treatment trains."
        },
        {
          id: "dosing",
          label: "GAS-SORBENT",
          title: "Gas-Sorbent Dosing",
          detail: "Inert carrier gas is combined with our gas-sorbent formulation and precisely dosed into the intake flow. Prepares feed for selective capture."
        },
        {
          id: "sorption",
          label: "SORPTION",
          title: "Sorption (Contactor)",
          detail: "Target ions, hardness and dissolved organics are captured on the sorbent surface under mild conditions — no membranes, no high pressures, no boiling."
        },
        {
          id: "separation",
          label: "SEPARATION",
          title: "Separation (Phase split)",
          detail: "Purified water is separated from the loaded sorbent by mechanical/physical means. No reverse osmosis or thermal distillation required. Residual stream is <5% of input flow."
        },
        {
          id: "polishing",
          label: "POLISHING",
          title: "Mineralization & Polishing",
          detail: "Final conditioning and polishing to deliver consistent drinking water quality (taste/mineral balance) per target specification."
        }
      ];

      const stepper = document.getElementById("hiwSteps");
      const footerSteps = document.getElementById("hiwFooterSteps");
      const detailKicker = document.getElementById("hiwDetailKicker");
      const detailTitle = document.getElementById("hiwDetailTitle");
      const detailText = document.getElementById("hiwDetailText");

      const moduleMap = {
        intake: document.getElementById("m-intake"),
        dosing: document.getElementById("m-dosing"),
        sorption: document.getElementById("m-sorption"),
        separation: document.getElementById("m-separation"),
        polishing: document.getElementById("m-polishing")
      };

      const now = new Date();
      const pad = (n) => String(n).padStart(2, "0");
      document.getElementById("hiwDate").textContent =
        `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}`;

      function renderSteps() {
        stepper.innerHTML = "";
        footerSteps.innerHTML = "";
        
        stages.forEach((s, idx) => {
          const li = document.createElement("li");
          li.className = "step";
          li.dataset.idx = String(idx);
          li.innerHTML = `
            <div class="step__dot">${idx + 1}</div>
            <div class="step__label">${s.label}</div>
          `;
          if (ENABLE_CLICKS) {
            li.style.cursor = "pointer";
            li.addEventListener("click", () => setActive(idx, true));
          }
          stepper.appendChild(li);

          const li2 = document.createElement("li");
          li2.className = "fstep";
          li2.dataset.idx = String(idx);
          li2.innerHTML = `
            <div class="fstep__idx">${idx + 1}</div>
            <div class="fstep__label">${s.title}</div>
          `;
          if (ENABLE_CLICKS) {
            li2.style.cursor = "pointer";
            li2.addEventListener("click", () => setActive(idx, true));
          }
          footerSteps.appendChild(li2);
        });
      }

      function clearActive() {
        document.querySelectorAll(".step").forEach(el => el.classList.remove("is-active"));
        document.querySelectorAll(".fstep").forEach(el => el.classList.remove("is-active"));
        Object.values(moduleMap).forEach(el => el.classList.remove("is-active"));
      }

      let active = 0;
      let timer = null;

      function setActive(idx, userAction = false) {
        active = idx;
        clearActive();

        const stepEl = stepper.querySelector(`.step[data-idx="${idx}"]`);
        const fstepEl = footerSteps.querySelector(`.fstep[data-idx="${idx}"]`);
        if (stepEl) stepEl.classList.add("is-active");
        if (fstepEl) fstepEl.classList.add("is-active");

        const s = stages[idx];
        detailKicker.textContent = `Stage ${idx + 1}`;
        detailTitle.textContent = s.title;
        detailText.textContent = s.detail;

        const m = moduleMap[s.id];
        if (m) m.classList.add("is-active");

        // Optional: pause autoplay after user click
        if (userAction && AUTOPLAY) {
          if (timer) clearInterval(timer);
          timer = setInterval(next, AUTOPLAY_MS);
        }
      }

      function next() {
        setActive((active + 1) % stages.length);
      }

      renderSteps();
      setActive(0);

      if (AUTOPLAY) {
        timer = setInterval(next, AUTOPLAY_MS);
      }
    })();
  </script>
</body>
</html>

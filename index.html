<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOW IT WORKS - AQUINTAQA</title>
    <style>
        :root {
            /* Engineering CAD palette - LOCKED */
            --bg: #F4F7FA;
            --grid-minor: rgba(120, 160, 190, 0.12);
            --grid-major: rgba(100, 140, 170, 0.18);
            --grid-accent: rgba(80, 130, 165, 0.08);
            
            /* Frame */
            --frame: rgba(140, 165, 185, 0.35);
            --frame-inner: rgba(140, 165, 185, 0.20);
            
            /* Accent - engineering aqua */
            --accent: #0891B2;
            --accent-light: #22D3EE;
            --accent-muted: rgba(8, 145, 178, 0.15);
            
            /* Core modules */
            --core-fill: #0891B2;
            --core-fill-light: rgba(8, 145, 178, 0.12);
            --core-stroke: #0891B2;
            --core-text: #FFFFFF;
            
            /* COTS modules */
            --cots-fill: #FFFFFF;
            --cots-stroke: rgba(100, 130, 160, 0.45);
            --cots-text: #1E3A5F;
            
            /* Concentrate */
            --conc-fill: rgba(251, 146, 60, 0.15);
            --conc-stroke: #F97316;
            --conc-text: #EA580C;
            
            /* Text */
            --text-primary: #1E3A5F;
            --text-secondary: rgba(30, 58, 95, 0.7);
            --text-muted: rgba(30, 58, 95, 0.5);
            
            /* Streams */
            --stream: rgba(30, 58, 95, 0.4);
            --stream-accent: #0891B2;
            --stream-dash: rgba(30, 58, 95, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* ===== ENGINEERING GRID BACKGROUND ===== */
        .hiw {
            min-height: 100vh;
            padding: 24px;
            background:
                /* Minor grid - subtle */
                linear-gradient(var(--grid-minor) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-minor) 1px, transparent 1px),
                /* Major grid - visible */
                linear-gradient(var(--grid-major) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-major) 1px, transparent 1px),
                /* Extra accent lines for engineering feel */
                linear-gradient(var(--grid-accent) 2px, transparent 2px),
                linear-gradient(90deg, var(--grid-accent) 2px, transparent 2px);
            background-color: var(--bg);
            background-size: 
                24px 24px, 24px 24px,
                120px 120px, 120px 120px,
                600px 600px, 600px 600px;
            position: relative;
        }

        /* Blueprint-style overlay gradient */
        .hiw::before {
            content: "";
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(8, 145, 178, 0.03) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(8, 145, 178, 0.02) 0%, transparent 50%);
            pointer-events: none;
        }

        .hiw__sheet {
            position: relative;
            margin: 0 auto;
            max-width: 1400px;
            padding: 20px;
        }

        /* ===== CAD FRAME ===== */
        .hiw__frame {
            position: absolute;
            inset: 0;
            border: 2px solid var(--frame);
            pointer-events: none;
        }

        .hiw__frame::after {
            content: "";
            position: absolute;
            inset: 8px;
            border: 1px solid var(--frame-inner);
        }

        /* Corner marks - engineering style */
        .hiw__corner {
            position: absolute;
            width: 20px;
            height: 20px;
        }
        .hiw__corner.tl { top: -1px; left: -1px; border-left: 3px solid var(--frame); border-top: 3px solid var(--frame); }
        .hiw__corner.tr { top: -1px; right: -1px; border-right: 3px solid var(--frame); border-top: 3px solid var(--frame); }
        .hiw__corner.bl { bottom: -1px; left: -1px; border-left: 3px solid var(--frame); border-bottom: 3px solid var(--frame); }
        .hiw__corner.br { bottom: -1px; right: -1px; border-right: 3px solid var(--frame); border-bottom: 3px solid var(--frame); }

        /* ===== HEADER ===== */
        .hiw__header {
            padding: 8px 20px 24px;
            text-align: center;
        }

        .hiw__title {
            font: 500 26px/1.1 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            letter-spacing: 0.35em;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        /* ===== MAIN LAYOUT ===== */
        .hiw__main {
            display: flex;
            gap: 0;
            margin-bottom: 0;
        }

        /* ===== LEFT SIDEBAR - Engineering style (no card) ===== */
        .hiw__left-sidebar {
            width: 180px;
            flex-shrink: 0;
            padding: 15px 0 15px 10px;
            /* No background - directly on grid */
        }

        .hiw__stage-nav {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .hiw__stage-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
            position: relative;
        }

        .hiw__stage-btn::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: width 0.2s ease;
        }

        .hiw__stage-btn:hover::before {
            width: 6px;
        }

        .hiw__stage-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .hiw__stage-name {
            font: 600 11px/1.3 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            transition: color 0.2s ease;
        }

        .hiw__stage-btn.is-active .hiw__stage-dot {
            background: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-muted);
        }

        .hiw__stage-btn.is-active .hiw__stage-name {
            color: var(--accent);
        }

        .hiw__stage-btn.is-active::before {
            width: 8px;
        }

        /* ===== DIAGRAM AREA ===== */
        .hiw__diagram-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .hiw__diagram-wrapper {
            position: relative;
            padding: 10px;
            margin-bottom: 0;
            /* No background card - directly on grid */
        }

        .hiw__svg {
            width: 100%;
            height: auto;
            display: block;
        }

        /* ===== SVG STYLES ===== */
        .svgLabel {
            font: 500 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            fill: var(--text-secondary);
        }

        .svgSubLabel {
            font: 400 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            fill: var(--text-muted);
        }

        .svgCalloutBox {
            fill: rgba(255, 255, 255, 0.9);
            stroke: var(--cots-stroke);
            stroke-width: 1.5;
        }

        .svgCalloutText {
            font: 500 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            fill: var(--text-secondary);
        }

        /* Module boxes */
        .moduleBox {
            stroke-width: 2;
            transition: all 0.25s ease;
        }

        .module .moduleTitle {
            font: 600 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            letter-spacing: 0.02em;
        }

        .module .moduleSub {
            font: 400 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* Core modules - filled aqua */
        .module.core .moduleBox {
            fill: var(--core-fill);
            stroke: var(--core-stroke);
            rx: 6;
        }

        .module.core .moduleTitle {
            fill: var(--core-text);
        }

        .module.core .moduleSub {
            fill: rgba(255, 255, 255, 0.85);
        }

        /* COTS modules - white with border */
        .module.cots .moduleBox {
            fill: var(--cots-fill);
            stroke: var(--cots-stroke);
            rx: 6;
        }

        .module.cots .moduleTitle {
            fill: var(--cots-text);
        }

        .module.cots .moduleSub {
            fill: var(--text-secondary);
        }

        /* Concentrate module */
        .module.concentrate .moduleBox {
            fill: var(--conc-fill);
            stroke: var(--conc-stroke);
            stroke-dasharray: 4 2;
            rx: 6;
        }

        .module.concentrate .moduleTitle {
            fill: var(--conc-text);
        }

        .module.concentrate .moduleSub {
            fill: var(--conc-text);
            opacity: 0.8;
        }

        /* Streams */
        .stream {
            fill: none;
            stroke: var(--stream);
            stroke-width: 2;
        }

        .stream.dashed {
            stroke-dasharray: 8 4;
        }

        .stream.accent {
            stroke: var(--stream-accent);
            stroke-width: 2.5;
        }

        .stream.concentrate {
            stroke: var(--conc-stroke);
            stroke-dasharray: 5 3;
            opacity: 0.7;
        }

        /* Core boundary - dashed rectangle */
        .coreBoundary {
            fill: none;
            stroke: var(--accent);
            stroke-width: 1.5;
            stroke-dasharray: 8 4;
            opacity: 0.4;
        }

        /* Active state */
        .module.is-active .moduleBox {
            stroke-width: 3;
            filter: drop-shadow(0 2px 8px rgba(8, 145, 178, 0.25));
        }

        /* ===== LEGEND ON DIAGRAM ===== */
        .svg-legend {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .svg-legend__title {
            font: 600 9px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .svg-legend__item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
        }

        .svg-legend__swatch {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .svg-legend__swatch.core {
            background: var(--core-fill);
        }

        .svg-legend__swatch.cots {
            background: #fff;
            border: 1.5px solid var(--cots-stroke);
        }

        .svg-legend__label {
            font: 400 9px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
        }

        .svg-legend__note {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(140, 165, 185, 0.25);
        }

        .svg-legend__note-text {
            font: 400 8px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-muted);
            font-style: italic;
        }

        .svg-legend__note-strong {
            display: block;
            margin-top: 4px;
            font: 500 8px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
            font-style: normal;
        }

        /* ===== BOTTOM PANEL - Engineering style ===== */
        .hiw__panel {
            border-top: 1px solid var(--frame-inner);
            padding-top: 16px;
            margin-top: 8px;
        }

        .hiw__tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--frame-inner);
            margin-bottom: 16px;
        }

        .hiw__tab {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            font: 500 11px/1.2 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            text-align: center;
            transition: all 0.2s ease;
            letter-spacing: 0.01em;
        }

        .hiw__tab::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: transparent;
            transition: background 0.2s ease;
        }

        .hiw__tab:hover {
            color: var(--accent);
        }

        .hiw__tab.is-active {
            color: var(--accent);
            font-weight: 600;
        }

        .hiw__tab.is-active::after {
            background: var(--accent);
        }

        /* Panel body - 3 column layout */
        .hiw__panel-body {
            display: grid;
            grid-template-columns: 200px 1fr 280px;
            gap: 24px;
            padding: 8px 0;
        }

        /* Left column - stage list */
        .hiw__panel-stages {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .hiw__panel-stage {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: transparent;
            border: none;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
            border-left: 2px solid transparent;
        }

        .hiw__panel-stage:hover {
            background: var(--accent-muted);
        }

        .hiw__panel-stage.is-active {
            background: var(--accent);
            border-left-color: var(--accent);
        }

        .hiw__panel-stage-num {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            background: transparent;
            border: 1.5px solid var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font: 600 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .hiw__panel-stage.is-active .hiw__panel-stage-num {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            color: #fff;
        }

        .hiw__panel-stage-name {
            font: 500 11px/1.3 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
        }

        .hiw__panel-stage.is-active .hiw__panel-stage-name {
            color: #fff;
        }

        /* Center column - description */
        .hiw__panel-detail {
            padding: 0 16px;
            border-left: 1px solid var(--frame-inner);
        }

        .hiw__detail-kicker {
            font: 600 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            letter-spacing: 0.08em;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 6px;
        }

        .hiw__detail-title {
            font: 600 16px/1.3 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-primary);
            margin: 0 0 10px 0;
            letter-spacing: 0.02em;
        }

        .hiw__detail-text {
            font: 400 13px/1.6 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
            max-width: 55ch;
        }

        /* Right column - legend */
        .hiw__panel-legend {
            padding-left: 16px;
            border-left: 1px solid var(--frame-inner);
        }

        .hiw__legend-title {
            font: 600 10px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .hiw__legend-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
        }

        .hiw__legend-swatch {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .hiw__legend-swatch.core {
            background: var(--core-fill);
        }

        .hiw__legend-swatch.cots {
            background: #fff;
            border: 1.5px solid var(--cots-stroke);
        }

        .hiw__legend-text {
            font: 400 10px/1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text-secondary);
        }

        .hiw__legend-sub {
            color: var(--text-muted);
            font-style: italic;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1100px) {
            .hiw__main {
                flex-direction: column;
            }
            .hiw__left-sidebar {
                width: 100%;
                padding: 10px;
            }
            .hiw__stage-nav {
                flex-direction: row;
                flex-wrap: wrap;
            }
            .hiw__panel-body {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            .hiw__panel-detail,
            .hiw__panel-legend {
                border-left: none;
                padding-left: 0;
                border-top: 1px solid var(--frame-inner);
                padding-top: 16px;
            }
        }

        @media (max-width: 768px) {
            .hiw__title {
                font-size: 18px;
                letter-spacing: 0.2em;
            }
            .hiw__tab {
                font-size: 10px;
                padding: 10px 4px;
            }
        }
    </style>
</head>
<body>

<section class="hiw" id="how-it-works">
    <div class="hiw__sheet">
        <!-- CAD Frame -->
        <div class="hiw__frame" aria-hidden="true">
            <span class="hiw__corner tl"></span>
            <span class="hiw__corner tr"></span>
            <span class="hiw__corner bl"></span>
            <span class="hiw__corner br"></span>
        </div>

        <!-- Header -->
        <header class="hiw__header">
            <h2 class="hiw__title">HOW IT WORKS</h2>
        </header>

        <!-- Main: Left sidebar + Diagram -->
        <div class="hiw__main">
            <!-- Left sidebar with stages -->
            <aside class="hiw__left-sidebar">
                <nav class="hiw__stage-nav">
                    <button class="hiw__stage-btn is-active" data-stage="0">
                        <span class="hiw__stage-dot"></span>
                        <span class="hiw__stage-name">Intake</span>
                    </button>
                    <button class="hiw__stage-btn" data-stage="1">
                        <span class="hiw__stage-dot"></span>
                        <span class="hiw__stage-name">Gas-Sorbent</span>
                    </button>
                    <button class="hiw__stage-btn" data-stage="2">
                        <span class="hiw__stage-dot"></span>
                        <span class="hiw__stage-name">Sorption</span>
                    </button>
                    <button class="hiw__stage-btn" data-stage="3">
                        <span class="hiw__stage-dot"></span>
                        <span class="hiw__stage-name">Separation</span>
                    </button>
                    <button class="hiw__stage-btn" data-stage="4">
                        <span class="hiw__stage-dot"></span>
                        <span class="hiw__stage-name">Mineralization<br>& Polishing</span>
                    </button>
                </nav>
            </aside>

            <!-- Diagram area -->
            <div class="hiw__diagram-area">
                <div class="hiw__diagram-wrapper">
                    <svg class="hiw__svg" viewBox="0 0 950 380" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--stream)" />
                            </marker>
                            <marker id="arrowAccent" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--stream-accent)" />
                            </marker>
                            <marker id="arrowConc" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="5" markerHeight="5" orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill="var(--conc-stroke)" />
                            </marker>
                        </defs>

                        <!-- Feed Water label -->
                        <text x="85" y="70" text-anchor="middle" class="svgLabel">Feed water</text>
                        <text x="85" y="84" text-anchor="middle" class="svgSubLabel">(seawater / brackish /</text>
                        <text x="85" y="96" text-anchor="middle" class="svgSubLabel">high-salinity / variable)</text>

                        <!-- Inert gas callout -->
                        <g class="svgCallout">
                            <rect x="195" y="22" width="110" height="36" rx="4" class="svgCalloutBox"/>
                            <text x="250" y="38" text-anchor="middle" class="svgCalloutText">Inert carrier gas</text>
                            <text x="250" y="50" text-anchor="middle" class="svgCalloutText">+ proprietary sorbent</text>
                        </g>

                        <!-- Arrow Feed to Intake -->
                        <path d="M 85 105 L 85 125" class="stream dashed" marker-end="url(#arrow)"/>

                        <!-- Arrow Inert to Dosing -->
                        <path d="M 250 58 L 250 125" class="stream dashed" marker-end="url(#arrow)"/>

                        <!-- INTAKE - COTS -->
                        <g id="m-intake" class="module cots">
                            <rect x="20" y="125" width="130" height="55" rx="6" class="moduleBox"/>
                            <text x="85" y="150" text-anchor="middle" class="moduleTitle">Intake</text>
                            <text x="85" y="165" text-anchor="middle" class="moduleSub">& Stabilization</text>
                        </g>

                        <!-- Arrow Intake to Dosing -->
                        <path d="M 150 152 L 185 152" class="stream" marker-end="url(#arrow)"/>

                        <!-- GAS-SORBENT - CORE -->
                        <g id="m-dosing" class="module core">
                            <rect x="185" y="125" width="130" height="55" rx="6" class="moduleBox"/>
                            <text x="250" y="147" text-anchor="middle" class="moduleTitle">GAS-SORBENT</text>
                            <text x="250" y="163" text-anchor="middle" class="moduleSub">Dosing</text>
                        </g>

                        <!-- Arrow Dosing to Sorption -->
                        <path d="M 315 152 L 350 152" class="stream accent" marker-end="url(#arrowAccent)"/>

                        <!-- SORPTION - CORE -->
                        <g id="m-sorption" class="module core">
                            <rect x="350" y="125" width="130" height="55" rx="6" class="moduleBox"/>
                            <text x="415" y="147" text-anchor="middle" class="moduleTitle">SORPTION</text>
                            <text x="415" y="163" text-anchor="middle" class="moduleSub">(Contactor)</text>
                        </g>

                        <!-- Arrow Sorption to Separation -->
                        <path d="M 480 152 L 515 152" class="stream accent" marker-end="url(#arrowAccent)"/>

                        <!-- SEPARATION - CORE -->
                        <g id="m-separation" class="module core">
                            <rect x="515" y="125" width="130" height="55" rx="6" class="moduleBox"/>
                            <text x="580" y="147" text-anchor="middle" class="moduleTitle">Separation</text>
                            <text x="580" y="163" text-anchor="middle" class="moduleSub">(Phase split)</text>
                        </g>

                        <!-- Arrow Separation to Mineralization -->
                        <path d="M 645 152 L 680 152" class="stream" marker-end="url(#arrow)"/>

                        <!-- MINERALIZATION - COTS -->
                        <g id="m-polishing" class="module cots">
                            <rect x="680" y="125" width="130" height="55" rx="6" class="moduleBox"/>
                            <text x="745" y="147" text-anchor="middle" class="moduleTitle">Mineralization</text>
                            <text x="745" y="163" text-anchor="middle" class="moduleSub">& Polishing</text>
                        </g>

                        <!-- Arrow to Concentrate -->
                        <path d="M 580 180 L 580 230 L 635 230 L 635 260" class="stream concentrate" marker-end="url(#arrowConc)"/>

                        <!-- LEGEND on diagram -->
                        <foreignObject x="20" y="220" width="340" height="150">
                            <div xmlns="http://www.w3.org/1999/xhtml" class="svg-legend">
                                <div class="svg-legend__title">LEGEND</div>
                                <div class="svg-legend__item">
                                    <span class="svg-legend__swatch core"></span>
                                    <span class="svg-legend__label">AQUINTAQA core module boundary (encapsulated/protected)</span>
                                </div>
                                <div class="svg-legend__item">
                                    <span class="svg-legend__swatch cots"></span>
                                    <span class="svg-legend__label">COTS-based auxiliary systems (intake, utilities, polishing, controls)</span>
                                </div>
                                <div class="svg-legend__note">
                                    <div class="svg-legend__note-text">Note: sensitive setpoints, materials, and core control logic are disclosed stepwise under NDA.</div>
                                    <div class="svg-legend__note-strong">Colour coding applies to modules only, not to streams.</div>
                                </div>
                            </div>
                        </foreignObject>

                        <!-- CONCENTRATE -->
                        <g id="m-concentrate" class="module concentrate">
                            <rect x="500" y="265" width="270" height="50" rx="6" class="moduleBox"/>
                            <text x="635" y="287" text-anchor="middle" class="moduleTitle">Concentrate / residual stream</text>
                            <text x="635" y="302" text-anchor="middle" class="moduleSub">(typically &lt;5% of flow; controlled output)</text>
                        </g>

                        <!-- Core boundary dashed -->
                        <rect x="178" y="118" width="475" height="70" rx="8" class="coreBoundary"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Bottom Panel -->
        <div class="hiw__panel">
            <div class="hiw__tabs" role="tablist">
                <button class="hiw__tab is-active" data-stage="0">1. Intake & Stabilization</button>
                <button class="hiw__tab" data-stage="1">2. Gas-Sorbent Dosing</button>
                <button class="hiw__tab" data-stage="2">3. Sorption (Contactor)</button>
                <button class="hiw__tab" data-stage="3">4. Separation (Phase split)</button>
                <button class="hiw__tab" data-stage="4">5. Mineralization & Polishing</button>
            </div>

            <div class="hiw__panel-body">
                <!-- Left: Stage list -->
                <div class="hiw__panel-stages">
                    <button class="hiw__panel-stage is-active" data-stage="0">
                        <span class="hiw__panel-stage-num">1</span>
                        <span class="hiw__panel-stage-name">Intake & Stabilization</span>
                    </button>
                    <button class="hiw__panel-stage" data-stage="1">
                        <span class="hiw__panel-stage-num">2</span>
                        <span class="hiw__panel-stage-name">Gas-Sorbent Dosing</span>
                    </button>
                    <button class="hiw__panel-stage" data-stage="2">
                        <span class="hiw__panel-stage-num">3</span>
                        <span class="hiw__panel-stage-name">Sorption (Contactor)</span>
                    </button>
                    <button class="hiw__panel-stage" data-stage="3">
                        <span class="hiw__panel-stage-num">4</span>
                        <span class="hiw__panel-stage-name">Separation (Phase split)</span>
                    </button>
                    <button class="hiw__panel-stage" data-stage="4">
                        <span class="hiw__panel-stage-num">5</span>
                        <span class="hiw__panel-stage-name">Mineralization & Polishing</span>
                    </button>
                </div>

                <!-- Center: Description -->
                <div class="hiw__panel-detail">
                    <div class="hiw__detail-kicker" id="detailKicker">STAGE 1</div>
                    <h3 class="hiw__detail-title" id="detailTitle">INTAKE & STABILIZATION</h3>
                    <p class="hiw__detail-text" id="detailText">Seawater or brackish water intake with coarse debris protection and flow stabilization. No heavy pre-treatment required.</p>
                </div>

                <!-- Right: Legend -->
                <div class="hiw__panel-legend">
                    <div class="hiw__legend-title">LEGEND</div>
                    <div class="hiw__legend-item">
                        <span class="hiw__legend-swatch core"></span>
                        <div class="hiw__legend-text">
                            AQUINTAQA core module boundary<br>
                            <span class="hiw__legend-sub">(инкапсулировано / защищено)</span>
                        </div>
                    </div>
                    <div class="hiw__legend-item">
                        <span class="hiw__legend-swatch cots"></span>
                        <div class="hiw__legend-text">
                            COTS-based auxiliary systems<br>
                            <span class="hiw__legend-sub">(интейк, утилиты, полировка, управлен.)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
(function() {
    const stages = [
        { id: 'intake', kicker: 'STAGE 1', title: 'INTAKE & STABILIZATION', detail: 'Seawater or brackish water intake with coarse debris protection and flow stabilization. No heavy pre-treatment required.' },
        { id: 'dosing', kicker: 'STAGE 2', title: 'GAS-SORBENT DOSING', detail: 'Inert gas is combined with our gas-sorbent formulation and precisely dosed into the intake flow. This step stabilizes water chemistry and prepares the feed for sorption.' },
        { id: 'sorption', kicker: 'STAGE 3', title: 'SORPTION (CONTACTOR)', detail: 'Salt ions, hardness and dissolved organics are bound to the sorbent surface. The process runs under mild conditions — no membranes, no high pressures, no boiling.' },
        { id: 'separation', kicker: 'STAGE 4', title: 'SEPARATION (PHASE SPLIT)', detail: 'Purified water is separated from the loaded sorbent by mechanical/physical means. No reverse osmosis or thermal distillation required. Residual stream is <5% of input flow.' },
        { id: 'polishing', kicker: 'STAGE 5', title: 'MINERALIZATION & POLISHING', detail: 'Final conditioning and polishing to deliver consistent drinking water quality (taste/mineral balance) per target specification.' }
    ];

    const moduleMap = {
        'intake': document.getElementById('m-intake'),
        'dosing': document.getElementById('m-dosing'),
        'sorption': document.getElementById('m-sorption'),
        'separation': document.getElementById('m-separation'),
        'polishing': document.getElementById('m-polishing')
    };

    const tabs = document.querySelectorAll('.hiw__tab');
    const sideBtns = document.querySelectorAll('.hiw__stage-btn');
    const panelStages = document.querySelectorAll('.hiw__panel-stage');
    const detailKicker = document.getElementById('detailKicker');
    const detailTitle = document.getElementById('detailTitle');
    const detailText = document.getElementById('detailText');

    let currentStage = 0;
    let autoplayTimer = null;
    const AUTOPLAY_INTERVAL = 4000; // 4 seconds

    function setActiveStage(index) {
        currentStage = index;
        const stage = stages[index];

        // Update tabs
        tabs.forEach((t, i) => t.classList.toggle('is-active', i === index));
        
        // Update sidebar buttons
        sideBtns.forEach((b, i) => b.classList.toggle('is-active', i === index));
        
        // Update panel stages
        panelStages.forEach((p, i) => p.classList.toggle('is-active', i === index));

        // Update modules
        Object.values(moduleMap).forEach(m => m.classList.remove('is-active'));
        if (moduleMap[stage.id]) moduleMap[stage.id].classList.add('is-active');

        // Update detail text
        detailKicker.textContent = stage.kicker;
        detailTitle.textContent = stage.title;
        detailText.textContent = stage.detail;
    }

    function nextStage() {
        setActiveStage((currentStage + 1) % stages.length);
    }

    function startAutoplay() {
        stopAutoplay();
        autoplayTimer = setInterval(nextStage, AUTOPLAY_INTERVAL);
    }

    function stopAutoplay() {
        if (autoplayTimer) {
            clearInterval(autoplayTimer);
            autoplayTimer = null;
        }
    }

    // Event listeners
    tabs.forEach((tab, i) => tab.addEventListener('click', () => {
        setActiveStage(i);
        startAutoplay(); // Reset autoplay on manual interaction
    }));

    sideBtns.forEach((btn, i) => btn.addEventListener('click', () => {
        setActiveStage(i);
        startAutoplay();
    }));

    panelStages.forEach((stage, i) => stage.addEventListener('click', () => {
        setActiveStage(i);
        startAutoplay();
    }));

    // Initialize
    setActiveStage(0);
    startAutoplay();
})();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AQUINTAQA - How It Works</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- RESET & BASE --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fbfcfd; /* Очень светлый, почти белый фон */
      color: #0b1220;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* --- VARIABLES --- */
    :root {
      --ink: #0b1220;
      --ink-dim: rgba(10,25,55,0.60);
      --ink-light: rgba(10,25,55,0.40);

      /* Engineering Colors */
      --cyan: #06b6d4;
      --cyan-bright: #22d3ee;
      --cyan-fill: rgba(34, 211, 238, 0.08);
      --cyan-stroke: rgba(6, 182, 212, 0.65);

      --amber: #f59e0b;
      --amber-dim: rgba(245,158,11,0.55);
      --amber-bg: rgba(245,158,11,0.08);

      --line: rgba(10,25,55,0.15);       /* Тонкие линии сетки */
      --line-strong: rgba(10,25,55,0.25); /* Контуры блоков */
      
      --glass: rgba(255, 255, 255, 0.7);
      --blur: 10px;
    }

    /* --- LAYOUT GRID --- */
    .screen2 {
      min-height: 100vh;
      position: relative;
      display: grid;
      /* Левая колонка - меню, Правая - схема + легенда внизу */
      grid-template-columns: 320px 1fr; 
      grid-template-rows: auto 1fr;
    }

    /* --- BACKGROUND (Blueprint Grid) --- */
    .screen2::before {
      content: "";
      position: absolute;
      inset: 0;
      /* Тонкая инженерная миллиметровка */
      background-image:
        linear-gradient(to right, rgba(10,25,55,0.05) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(10,25,55,0.05) 1px, transparent 1px);
      background-size: 20px 20px;
      z-index: 0;
      pointer-events: none;
    }

    /* --- HEADER --- */
    .header {
      grid-column: 1 / -1;
      padding: 30px 0 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
      border-bottom: 1px solid var(--line);
      background: rgba(251, 252, 253, 0.9);
    }

    .header-title {
      font-size: 32px;
      font-weight: 600;
      letter-spacing: -0.02em;
      color: var(--ink);
      text-transform: uppercase;
    }

    /* --- LEFT COLUMN (CONTROLS) --- */
    .left-col {
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--line);
      position: relative;
      z-index: 2;
      background: var(--glass);
      backdrop-filter: blur(var(--blur));
    }

    .stages-list {
      padding: 20px 0;
      display: flex;
      flex-direction: column;
    }

    .stage-item {
      padding: 16px 32px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .stage-item:hover {
      background: rgba(10,25,55,0.03);
    }

    .stage-item.active {
      border-left-color: var(--cyan);
      background: linear-gradient(90deg, var(--cyan-fill), transparent);
    }

    .stage-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--ink-dim);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stage-item.active .stage-name {
      color: #000; /* Контрастный активный цвет */
    }
    
    .stage-indicator {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--line-strong);
      opacity: 0.3;
    }
    
    .stage-item.active .stage-indicator {
      background: var(--cyan-bright);
      opacity: 1;
    }

    .info-panel {
      margin-top: auto;
      padding: 32px;
      border-top: 1px solid var(--line);
      background: rgba(255,255,255,0.5);
    }

    .info-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--cyan);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
    }

    .info-text {
      font-size: 14px;
      color: var(--ink-dim);
      line-height: 1.5;
    }

    /* --- RIGHT COLUMN (DIAGRAM WRAPPER) --- */
    .right-col {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between; /* Схема сверху, Легенда снизу */
      padding: 40px 60px;
    }

    .diagram-container {
      width: 100%;
      max-width: 860px;
      margin: 0 auto;
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* SVG STYLES */
    .diagram-svg {
      width: 100%;
      height: auto;
      display: block;
      overflow: visible;
    }

    /* Lines */
    .flow-line {
      stroke: var(--cyan-stroke);
      stroke-width: 1.5;
      fill: none;
    }
    .flow-line.aux { stroke: var(--line-strong); stroke-dasharray: 4 4; }
    .flow-line.residual { stroke: var(--amber-dim); stroke-dasharray: 4 4; }

    /* Blocks */
    .node-box {
      fill: #fff;
      stroke: var(--line-strong);
      stroke-width: 1.5;
      transition: all 0.3s ease;
    }

    /* Core Modules (Cyan) */
    .node-box.core {
      stroke: var(--cyan-stroke);
      fill: var(--cyan-fill);
    }

    /* Active State (Highlight) */
    .node-group.active .node-box {
      stroke: var(--cyan);
      stroke-width: 2.5;
      filter: drop-shadow(0 0 8px rgba(34, 211, 238, 0.4));
    }

    /* Text Labels in Diagram */
    .node-label {
      fill: var(--ink);
      font-size: 11px;
      font-weight: 600;
      text-anchor: middle;
      dominant-baseline: middle;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }
    .node-sublabel {
      fill: var(--ink-dim);
      font-size: 9px;
      text-anchor: middle;
      dominant-baseline: middle;
    }
    
    .text-on-line {
        fill: var(--ink-dim);
        font-size: 10px;
        font-weight: 500;
        text-anchor: middle;
        background: #fbfcfd; /* Hack to hide line behind text if needed */
    }

    /* Special Blocks */
    .drinking-box { stroke: var(--cyan); fill: rgba(34,211,238,0.15); }
    .drinking-label { fill: #0891b2; font-weight: 700; }
    
    .concentrate-box { stroke: var(--amber); fill: var(--amber-bg); }
    .concentrate-label { fill: #d97706; }

    /* --- LEGEND (Strict Layout) --- */
    .legend-container {
      width: 100%;
      max-width: 860px;
      margin: 0 auto;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid var(--line); /* Жирная черта как в чертеже */
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .legend-title {
      font-size: 10px;
      text-transform: uppercase;
      color: var(--ink-light);
      letter-spacing: 0.1em;
      margin-bottom: 4px;
    }

    .legend-row {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      align-items: center;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Legend Boxes */
    .leg-box {
      width: 16px; height: 16px;
      border-radius: 2px;
    }
    .leg-box.core {
      background: var(--cyan-fill);
      border: 1.5px solid var(--cyan-stroke);
    }
    .leg-box.aux {
      background: #fff;
      border: 1.5px solid var(--line-strong);
    }

    .leg-text {
      font-size: 12px;
      color: var(--ink);
      font-weight: 500;
    }
    .leg-sub {
      color: var(--ink-dim);
      font-weight: 400;
    }

    .legend-notes {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .note-text {
      font-size: 11px;
      color: var(--ink-dim);
    }
    .note-text strong { font-weight: 600; color: var(--ink); }
    .note-sub { font-size: 11px; color: var(--ink-light); font-style: italic; }

    /* --- MOBILE --- */
    @media (max-width: 1024px) {
      .screen2 { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; }
      .left-col { border-right: none; border-bottom: 1px solid var(--line); }
      .stages-list { flex-direction: row; overflow-x: auto; padding: 0; }
      .stage-item { padding: 12px 16px; white-space: nowrap; border-left: none; border-bottom: 3px solid transparent; }
      .stage-item.active { border-bottom-color: var(--cyan); }
      .stage-indicator { display: none; }
      
      .right-col { padding: 20px; }
      .diagram-container { min-width: 600px; } /* Horizontal scroll fix */
      .right-col { overflow-x: auto; display: block; } /* Allow scroll */
      
      .legend-row { gap: 15px; flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>

  <section class="screen2">
    
    <!-- HEADER -->
    <header class="header">
      <h2 class="header-title">HOW IT WORKS</h2>
    </header>

    <!-- LEFT MENU -->
    <div class="left-col">
      <nav class="stages-list">
        <div class="stage-item active" data-stage="1">
          <span class="stage-name">1. Intake</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="2">
          <span class="stage-name">2. Gas-Sorbent</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="3">
          <span class="stage-name">3. Sorption</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="4">
          <span class="stage-name">4. Separation</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="5">
          <span class="stage-name">5. Polishing</span>
          <div class="stage-indicator"></div>
        </div>
      </nav>

      <div class="info-panel">
        <div class="info-title" id="infoTitle">Intake &amp; Stabilization</div>
        <div class="info-text" id="infoText">
          Coarse protection against debris, flow stabilisation. No heavy pre-treatment required.
        </div>
      </div>
    </div>

    <!-- RIGHT CONTENT -->
    <div class="right-col">
      
      <!-- DIAGRAM -->
      <div class="diagram-container">
        <svg class="diagram-svg" viewBox="0 0 800 460" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Definitions for markers/filters -->
          <defs>
            <marker id="arrow-cyan" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L6,3 L0,6" fill="none" stroke="#22d3ee" stroke-width="1"/>
            </marker>
             <marker id="arrow-gray" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
              <path d="M0,0 L6,3 L0,6" fill="none" stroke="rgba(10,25,55,0.25)" stroke-width="1"/>
            </marker>
          </defs>

          <!-- CONNECTING LINES (Strict Orthogonal) -->
          <!-- Feed to Intake -->
          <path d="M 90 100 L 150 100" class="flow-line aux" marker-end="url(#arrow-gray)"/>
          
          <!-- Intake to Gas-Sorbent -->
          <path d="M 270 100 L 315 100 L 315 140 L 360 140" class="flow-line" marker-end="url(#arrow-cyan)"/>
          
          <!-- Inert Gas Aux Input -->
          <path d="M 420 55 L 420 110" class="flow-line aux" marker-end="url(#arrow-gray)"/>
          
          <!-- Gas-Sorbent to Sorption -->
          <path d="M 480 140 L 520 140 L 520 220 L 560 220" class="flow-line" marker-end="url(#arrow-cyan)"/>
          
          <!-- Sorption to Separation -->
          <path d="M 620 250 L 620 300 L 605 300" class="flow-line" marker-end="url(#arrow-cyan)"/>
          
          <!-- Separation to Polishing -->
          <path d="M 485 300 L 440 300 L 440 380 L 465 380" class="flow-line aux" marker-end="url(#arrow-gray)"/>
          
          <!-- Separation to Concentrate -->
          <path d="M 545 330 L 545 420 L 230 420" class="flow-line residual" marker-end="url(#arrow-gray)"/>
          
          <!-- Polishing to Drinking -->
          <path d="M 585 380 L 602 380 L 602 420 L 630 420" class="flow-line aux" marker-end="url(#arrow-gray)"/>


          <!-- BLOCKS -->
          
          <!-- Feed Label (No box, just text as per clean request) -->
          <g class="node-group">
             <text class="text-on-line" x="60" y="95">Feed Water</text>
             <text class="text-on-line" x="60" y="108" font-size="9" fill="#999">(Seawater)</text>
          </g>

          <!-- 1. Intake -->
          <g class="node-group" id="node1">
            <rect class="node-box" x="150" y="70" width="120" height="60" rx="2"/>
            <text class="node-label" x="210" y="92">Intake</text>
            <text class="node-sublabel" x="210" y="108">&amp; Stabilization</text>
          </g>

          <!-- Aux: Inert Gas -->
          <g class="node-group">
            <rect class="node-box" x="365" y="10" width="110" height="45" rx="2"/>
            <text class="node-label" x="420" y="28">Inert Gas</text>
            <text class="node-sublabel" x="420" y="42">+ Sorbent</text>
          </g>

          <!-- 2. Gas-Sorbent -->
          <g class="node-group" id="node2">
            <rect class="node-box core" x="360" y="110" width="120" height="60" rx="2"/>
            <text class="node-label" x="420" y="132">Gas-Sorbent</text>
            <text class="node-sublabel" x="420" y="148">Dosing</text>
          </g>

          <!-- 3. Sorption -->
          <g class="node-group" id="node3">
            <rect class="node-box core" x="560" y="190" width="120" height="60" rx="2"/>
            <text class="node-label" x="620" y="212">Sorption</text>
            <text class="node-sublabel" x="620" y="228">Contactor</text>
          </g>

          <!-- 4. Separation -->
          <g class="node-group" id="node4">
            <rect class="node-box core" x="485" y="270" width="120" height="60" rx="2"/>
            <text class="node-label" x="545" y="292">Separation</text>
            <text class="node-sublabel" x="545" y="308">Phase Split</text>
          </g>

          <!-- 5. Polishing -->
          <g class="node-group" id="node5">
            <rect class="node-box" x="465" y="350" width="120" height="60" rx="2"/>
            <text class="node-label" x="525" y="372">Polishing</text>
            <text class="node-sublabel" x="525" y="388">&amp; Mineral.</text>
          </g>

          <!-- Output: Concentrate -->
          <g class="node-group">
            <rect class="node-box concentrate-box" x="120" y="395" width="110" height="50" rx="2"/>
            <text class="node-label concentrate-label" x="175" y="415">Concentrate</text>
            <text class="node-sublabel" x="175" y="430">&lt;5% flow</text>
          </g>

          <!-- Output: Drinking -->
          <g class="node-group">
            <rect class="node-box drinking-box" x="630" y="395" width="110" height="50" rx="2"/>
            <text class="node-label drinking-label" x="685" y="415">Drinking</text>
            <text class="node-sublabel" x="685" y="430">Water</text>
          </g>
        </svg>
      </div>

      <!-- LEGEND (Bottom Block) -->
      <div class="legend-container">
        
        
        <div class="legend-row">
          <!-- Item 1 -->
          <div class="legend-item">
            <div class="leg-box core"></div>
            <div class="leg-text">
              AQUINTAQA core module boundary
              <span class="leg-sub">(encapsulated/protected)</span>
            </div>
          </div>
          
          <!-- Item 2 -->
          <div class="legend-item">
            <div class="leg-box aux"></div>
            <div class="leg-text">
              COTS-based auxiliary systems
              <span class="leg-sub">(intake, utilities, polishing, controls)</span>
            </div>
          </div>
        </div>

        <div class="legend-notes">
          <div class="note-text">
            <strong>Note:</strong> Sensitive setpoints, materials, and core control logic are disclosed stepwise under NDA.
          </div>
          <div class="note-sub">
            Colour coding applies to modules only, not to streams.
          </div>
        </div>
      </div>

    </div>
  </section>

  <script>
    const stageData = {
      1: { title: 'Intake & Stabilization', text: 'Coarse protection against debris, flow stabilisation and optional baseline pH/oxygen conditioning. No heavy pre-treatment trains required.' },
      2: { title: 'Gas-Sorbent Dosing', text: 'An inert carrier gas with fine-dispersed proprietary sorbent is dosed into the flow. Active capture centres are formed, preparing the solution for selective ion extraction.' },
      3: { title: 'Sorption (Contactor)', text: 'Salt ions, hardness and dissolved organics are bound to the sorbent surface. The process runs under mild conditions — no membranes, no high pressures, no boiling.' },
      4: { title: 'Separation (Phase split)', text: 'Purified water is separated from the loaded sorbent by mechanical/physical means. No reverse osmosis or thermal distillation required. Residual stream is <5% of input flow.' },
      5: { title: 'Mineralization & Polishing', text: 'Precise remineralisation to drinking water profile (TDS ~100-150 mg/L), Ca/Mg balance, pH 7.2-7.8. Optional UV/ozone disinfection. Ready-to-drink output.' }
    };

    let currentStage = 1;
    let autoPlayTimer;

    const stageItems = document.querySelectorAll('.stage-item');
    const infoTitle = document.getElementById('infoTitle');
    const infoText = document.getElementById('infoText');

    function setActiveStage(stage) {
      currentStage = stage;

      stageItems.forEach(item => {
        item.classList.toggle('active', parseInt(item.dataset.stage, 10) === stage);
      });

      document.querySelectorAll('.node-group').forEach(node => node.classList.remove('active'));
      const activeNode = document.getElementById(`node${stage}`);
      if (activeNode) activeNode.classList.add('active');

      const infoPanel = document.querySelector('.info-panel');
      infoPanel.style.opacity = '0.6';
      
      setTimeout(() => {
        const data = stageData[stage];
        if (data) {
          infoTitle.textContent = data.title;
          infoText.textContent = data.text;
        }
        infoPanel.style.opacity = '1';
      }, 150);
    }

    function startAutoPlay() {
      clearInterval(autoPlayTimer);
      autoPlayTimer = setInterval(() => {
          let next = currentStage + 1;
          if (next > 5) next = 1;
          setActiveStage(next);
      }, 4000);
    }

    stageItems.forEach(item => {
      item.addEventListener('click', () => {
        clearInterval(autoPlayTimer);
        setActiveStage(parseInt(item.dataset.stage, 10));
      });
    });

    // Start
    setActiveStage(1);
    startAutoPlay();
  </script>
</body>
</html>

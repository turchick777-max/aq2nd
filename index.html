<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AQUINTAQA - How It Works</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- RESET & BASE --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fbfcfd;
      color: #0b1220;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* --- VARIABLES --- */
    :root {
      --ink: #0b1220;
      --ink-2: rgba(10,25,55,0.72);
      --ink-3: rgba(10,25,55,0.58);

      /* Colors */
      --cyan: #06b6d4; /* Чуть темнее для читаемости на светлом */
      --cyan-bright: #22d3ee;
      --cyan-dim: rgba(6, 182, 212, 0.65);
      --cyan-bg: rgba(34, 211, 238, 0.08);

      --amber: #f59e0b;
      --amber-dim: rgba(245,158,11,0.55);
      --amber-bg: rgba(245,158,11,0.08);

      --line: rgba(10,25,55,0.12);
      --line-strong: rgba(10,25,55,0.20);
      
      --glass: rgba(255, 255, 255, 0.65);
      --blur: 12px;
    }

    /* --- LAYOUT --- */
    .screen2 {
      min-height: 100vh;
      position: relative;
      display: grid;
      grid-template-columns: 320px 1fr; /* Левая колонка чуть шире для удобства чтения */
      grid-template-rows: auto 1fr;
    }

    /* --- BACKGROUND GRID --- */
    .screen2::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(to right, rgba(10,25,55,0.06) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(10,25,55,0.06) 1px, transparent 1px);
      background-size: 20px 20px;
      mask-image: radial-gradient(circle at center, black 40%, transparent 90%); /* Фокус в центре */
      pointer-events: none;
      z-index: 0;
    }

    /* --- HEADER --- */
    .header {
      grid-column: 1 / -1;
      padding: 40px 0 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 2;
    }

    .header-title {
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: var(--ink);
      margin-bottom: 8px;
    }
    
    .header-subtitle {
      font-size: 14px;
      color: var(--ink-3);
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    /* --- LEFT COLUMN (CONTROLS) --- */
    .left-col {
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--line);
      position: relative;
      z-index: 2;
      background: var(--glass);
      backdrop-filter: blur(var(--blur));
    }

    .stages-list {
      padding: 30px 0;
      display: flex;
      flex-direction: column;
    }

    .stage-item {
      padding: 18px 32px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .stage-item:hover {
      background: rgba(10,25,55,0.02);
    }

    .stage-item.active {
      border-left-color: var(--cyan);
      background: linear-gradient(90deg, var(--cyan-bg), transparent);
    }

    .stage-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--ink-3);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      transition: color 0.2s;
    }

    .stage-item.active .stage-name {
      color: var(--cyan); /* Используем более темный оттенок для текста */
    }
    
    /* Индикатор прогресса (кружок) */
    .stage-indicator {
      width: 8px; 
      height: 8px;
      border-radius: 50%;
      background: var(--line-strong);
      opacity: 0.5;
      transition: all 0.3s;
    }
    
    .stage-item.active .stage-indicator {
      background: var(--cyan-bright);
      opacity: 1;
      box-shadow: 0 0 10px var(--cyan-bright);
    }

    .info-panel {
      margin-top: auto;
      padding: 32px;
      border-top: 1px solid var(--line);
      background: rgba(255,255,255,0.4);
    }

    .info-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--cyan);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 12px;
    }

    .info-text {
      font-size: 15px;
      color: var(--ink-2);
      line-height: 1.6;
    }

    /* --- RIGHT COLUMN (DIAGRAM) --- */
    .right-col {
      padding: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
      overflow: hidden;
    }

    .diagram-container {
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    .diagram-svg {
      width: 100%;
      height: auto;
      display: block;
      /* Фильтр для четкости на ретина дисплеях */
      shape-rendering: geometricPrecision; 
    }

    /* --- SVG ELEMENTS STYLING --- */
    
    /* Lines */
    .flow-line {
      stroke: var(--cyan-dim);
      stroke-width: 1.5;
      stroke-dasharray: 6 4;
      fill: none;
      transition: stroke-width 0.3s;
    }
    
    .flow-line.aux { stroke: var(--line-strong); }
    .flow-line.residual { stroke: var(--amber-dim); }

    /* Nodes */
    .node-group { cursor: default; }

    .node-box {
      fill: rgba(255,255,255,0.9);
      stroke: var(--line-strong);
      stroke-width: 1.5;
      transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    .node-box.core {
      stroke: var(--cyan-dim);
      fill: rgba(34,211,238,0.05);
    }

    /* Active State */
    .node-group.active .node-box {
      stroke: var(--cyan-bright);
      stroke-width: 2.5;
      fill: #fff;
      filter: url(#glow); /* Ссылка на SVG фильтр */
    }
    
    .node-group.active text {
      fill: var(--ink);
    }
    
    .node-group.active .node-sublabel {
      fill: var(--cyan);
    }

    /* Text */
    .node-label {
      fill: var(--ink);
      font-family: 'Inter', sans-serif;
      font-size: 11px;
      font-weight: 700;
      text-anchor: middle;
      dominant-baseline: middle; /* Вертикальное центрирование */
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: fill 0.3s;
    }

    .node-sublabel {
      fill: var(--ink-3);
      font-family: 'Inter', sans-serif;
      font-size: 9px;
      text-anchor: middle;
      dominant-baseline: middle;
      transition: fill 0.3s;
    }

    /* Special Nodes */
    .drinking-box {
      stroke: var(--cyan-bright);
      fill: var(--cyan-bg);
    }
    .drinking-label { fill: var(--cyan); }
    
    .concentrate-box {
      stroke: var(--amber);
      fill: var(--amber-bg);
    }
    .concentrate-label { fill: var(--amber); }

    /* Core Process Label */
    .core-area-label {
      fill: rgba(10,25,55,0.3);
      font-size: 9px;
      letter-spacing: 0.15em;
      font-weight: 600;
    }

    /* --- LEGEND --- */
    .legend {
      width: 100%;
      display: flex;
      gap: 32px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      padding-top: 24px;
      border-top: 1px solid var(--line);
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      font-weight: 500;
      color: var(--ink-3);
    }

    .legend-marker {
      width: 16px; 
      height: 16px;
      border-radius: 3px;
    }
    
    .legend-marker.core { border: 1.5px solid var(--cyan-dim); background: var(--cyan-bg); }
    .legend-marker.aux { border: 1.5px solid var(--line-strong); background: #fff; }
    
    .legend-line-marker { height: 2px; width: 30px; }
    .legend-line-marker.main { border-top: 2px dashed var(--cyan-bright); }
    .legend-line-marker.res { border-top: 2px dashed var(--amber); }

    /* --- RESPONSIVE --- */
    @media (max-width: 1024px) {
      .screen2 { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; }
      .header { padding: 30px 20px 20px; }
      .header-title { font-size: 32px; }

      .left-col {
        border-right: none;
        border-bottom: 1px solid var(--line);
      }

      .stages-list {
        flex-direction: row;
        overflow-x: auto;
        padding: 0;
        scroll-behavior: smooth;
        /* Hide scrollbar */
        -ms-overflow-style: none;  
        scrollbar-width: none;  
      }
      .stages-list::-webkit-scrollbar { display: none; }

      .stage-item {
        padding: 16px 20px;
        white-space: nowrap;
        border-left: none;
        border-bottom: 2px solid transparent;
        flex-direction: column;
        gap: 6px;
        justify-content: center;
      }
      
      .stage-indicator { display: none; } /* Убираем кружки на мобиле */

      .stage-item.active {
        border-bottom-color: var(--cyan);
        background: rgba(34,211,238,0.05);
      }

      .info-panel { padding: 20px; }
      .right-col { padding: 20px; overflow-x: auto; display: block;} /* Разрешаем скролл схемы */
      
      .diagram-container {
        min-width: 600px; /* Фиксируем мин ширину схемы чтобы не плющилась */
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>

  <section class="screen2">
    
    <header class="header">
      <h2 class="header-title">HOW IT WORKS</h2>
      <span class="header-subtitle">Advanced Water Purification Process</span>
    </header>

    <div class="left-col">
      <nav class="stages-list">
        <div class="stage-item active" data-stage="1">
          <span class="stage-name">1. Intake</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="2">
          <span class="stage-name">2. Gas-Sorbent</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="3">
          <span class="stage-name">3. Sorption</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="4">
          <span class="stage-name">4. Separation</span>
          <div class="stage-indicator"></div>
        </div>
        <div class="stage-item" data-stage="5">
          <span class="stage-name">5. Polishing</span>
          <div class="stage-indicator"></div>
        </div>
      </nav>

      <div class="info-panel">
        <div class="info-title" id="infoTitle">Intake &amp; Stabilization</div>
        <div class="info-text" id="infoText">
          Coarse protection against debris, flow stabilisation and optional baseline pH/oxygen conditioning. No heavy pre-treatment trains required.
        </div>
      </div>
    </div>

    <div class="right-col">
      <div class="diagram-container">
        
        <!-- SVG DIAGRAM: ViewBox 0 0 800 500 для удобной сетки -->
        <svg class="diagram-svg" viewBox="0 0 800 520" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <!-- Фильтр свечения для активных элементов -->
            <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="4" result="blur" />
              <feComposite in="SourceGraphic" in2="blur" operator="over" />
            </filter>
          </defs>

          <!-- CONNECTING LINES (Strict Orthogonal Geometry) -->
          
          <!-- 1. Feed to Intake -->
          <!-- Feed Box Right: 105, Center Y: 120 -> Intake Box Left: 165 -->
          <path d="M 105 120 L 165 120" class="flow-line aux"/>

          <!-- 2. Intake to Gas-Sorbent -->
          <!-- Intake Right: 285 -> GasSorbent Left: 360. Y shifts from 120 to 160 -->
          <path d="M 285 120 L 322 120 L 322 160 L 360 160" class="flow-line"/>

          <!-- Aux: Inert Gas to Gas-Sorbent -->
          <!-- Inert Gas Bottom: 420, 75 -> GasSorbent Top: 420, 130 -->
          <path d="M 420 75 L 420 130" class="flow-line aux"/>

          <!-- 3. Gas-Sorbent to Sorption -->
          <!-- GasSorbent Right: 480 -> Sorption Left: 560. Y shifts 160 -> 240 -->
          <path d="M 480 160 L 520 160 L 520 240 L 560 240" class="flow-line"/>

          <!-- 4. Sorption to Separation -->
          <!-- Sorption Right: 680 -> Separation Right Entry (Loop back) -->
          <!-- Sorption Bottom: 620, 270 -> Separation Right: 605. Let's enter Separation from Right side at 320 -->
          <path d="M 620 270 L 620 320 L 605 320" class="flow-line"/>

          <!-- 5. Separation to Polishing -->
          <!-- Separation Left: 485, 320 -> Polishing Top: 485, 380? Or Left? -->
          <!-- Let's go Left out of Sep (485) -> Down -> Right into Polishing (465) -->
          <path d="M 485 320 L 440 320 L 440 410 L 465 410" class="flow-line aux"/>
          
          <!-- Separation to Concentrate (Residual) -->
          <!-- Separation Bottom: 545, 350 -> Concentrate Right: 220, 420 -->
          <path d="M 545 350 L 545 445 L 220 445" class="flow-line residual"/>

          <!-- 6. Polishing to Drinking -->
          <!-- Polishing Right: 585, 410 -> Drinking Left: 620, 470 -->
          <path d="M 585 410 L 602 410 L 602 470 L 620 470" class="flow-line aux"/>


          <!-- NODES (Centered Logic) -->
          
          <!-- NODE 0: FEED -->
          <g class="node-group">
            <rect class="node-box" x="40" y="90" width="65" height="60" rx="4"/>
            <text class="node-label" x="72.5" y="112">Feed</text>
            <text class="node-sublabel" x="72.5" y="128">Seawater</text>
          </g>

          <!-- NODE 1: INTAKE -->
          <g class="node-group" id="node1">
            <rect class="node-box" x="165" y="90" width="120" height="60" rx="4"/>
            <text class="node-label" x="225" y="112">Intake</text>
            <text class="node-sublabel" x="225" y="128">&amp; Stabilization</text>
          </g>

          <!-- AUX: INERT GAS -->
          <g class="node-group">
            <rect class="node-box" x="365" y="30" width="110" height="45" rx="4"/>
            <text class="node-label" x="420" y="48">Inert Gas</text>
            <text class="node-sublabel" x="420" y="62">+ Sorbent</text>
          </g>

          <!-- NODE 2: GAS-SORBENT -->
          <g class="node-group" id="node2">
            <rect class="node-box core" x="360" y="130" width="120" height="60" rx="4"/>
            <text class="node-label" x="420" y="152">Gas-Sorbent</text>
            <text class="node-sublabel" x="420" y="168">Dosing</text>
          </g>

          <!-- LABELS -->
          <text class="core-area-label" x="310" y="170">CORE</text>
          <text class="core-area-label" x="310" y="182">PROCESS</text>

          <!-- NODE 3: SORPTION -->
          <g class="node-group" id="node3">
            <rect class="node-box core" x="560" y="210" width="120" height="60" rx="4"/>
            <text class="node-label" x="620" y="232">Sorption</text>
            <text class="node-sublabel" x="620" y="248">Contactor</text>
          </g>

          <!-- NODE 4: SEPARATION -->
          <g class="node-group" id="node4">
            <rect class="node-box core" x="485" y="290" width="120" height="60" rx="4"/>
            <text class="node-label" x="545" y="312">Separation</text>
            <text class="node-sublabel" x="545" y="328">Phase Split</text>
          </g>

          <!-- NODE 5: POLISHING -->
          <g class="node-group" id="node5">
            <rect class="node-box" x="465" y="380" width="120" height="60" rx="4"/>
            <text class="node-label" x="525" y="402">Polishing</text>
            <text class="node-sublabel" x="525" y="418">&amp; Mineral.</text>
          </g>

          <!-- AUX: CONCENTRATE -->
          <g class="node-group">
            <rect class="node-box concentrate-box" x="120" y="420" width="100" height="50" rx="4"/>
            <text class="node-label concentrate-label" x="170" y="440">Concentrate</text>
            <text class="node-sublabel" x="170" y="455">&lt;5% flow</text>
          </g>

          <!-- AUX: DRINKING WATER -->
          <g class="node-group">
            <rect class="node-box drinking-box" x="620" y="445" width="110" height="50" rx="4"/>
            <text class="node-label drinking-label" x="675" y="465">Drinking</text>
            <text class="node-sublabel" x="675" y="480">Water</text>
          </g>
        </svg>

        <div class="legend">
          <div class="legend-item">
            <span class="legend-marker core"></span>
            <span>Core Module</span>
          </div>
          <div class="legend-item">
            <span class="legend-marker aux"></span>
            <span>Auxiliary</span>
          </div>
          <div class="legend-item">
            <span class="legend-line-marker main"></span>
            <span>Main flow</span>
          </div>
          <div class="legend-item">
            <span class="legend-line-marker res"></span>
            <span>Residual</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    const stageData = {
      1: { title: 'Intake & Stabilization', text: 'Coarse protection against debris, flow stabilisation and optional baseline pH/oxygen conditioning. No heavy pre-treatment trains required.' },
      2: { title: 'Gas-Sorbent Dosing', text: 'An inert carrier gas with fine-dispersed proprietary sorbent is dosed into the flow. Active capture centres are formed, preparing the solution for selective ion extraction.' },
      3: { title: 'Sorption (Contactor)', text: 'Salt ions, hardness and dissolved organics are bound to the sorbent surface. The process runs under mild conditions — no membranes, no high pressures, no boiling.' },
      4: { title: 'Separation (Phase split)', text: 'Purified water is separated from the loaded sorbent by mechanical/physical means. No reverse osmosis or thermal distillation required. Residual stream is <5% of input flow.' },
      5: { title: 'Mineralization & Polishing', text: 'Precise remineralisation to drinking water profile (TDS ~100-150 mg/L), Ca/Mg balance, pH 7.2-7.8. Optional UV/ozone disinfection. Ready-to-drink output.' }
    };

    let currentStage = 1;
    let isAutoPlaying = true;
    let autoPlayTimer;

    const stageItems = document.querySelectorAll('.stage-item');
    const infoTitle = document.getElementById('infoTitle');
    const infoText = document.getElementById('infoText');

    function setActiveStage(stage) {
      currentStage = stage;

      // Update Left Menu
      stageItems.forEach(item => {
        const isActive = parseInt(item.dataset.stage, 10) === stage;
        item.classList.toggle('active', isActive);
      });

      // Update SVG Nodes
      document.querySelectorAll('.node-group').forEach(node => node.classList.remove('active'));
      const activeNode = document.getElementById(`node${stage}`);
      if (activeNode) activeNode.classList.add('active');

      // Update Info Text with Fade Effect
      const infoPanel = document.querySelector('.info-panel');
      infoPanel.style.opacity = '0.5';
      
      setTimeout(() => {
        const data = stageData[stage];
        if (data) {
          infoTitle.textContent = data.title;
          infoText.textContent = data.text;
        }
        infoPanel.style.opacity = '1';
      }, 150);
    }

    function startAutoPlay() {
      stopAutoPlay(); // Clear existing to be safe
      autoPlayTimer = setInterval(() => {
        if (isAutoPlaying) {
          let next = currentStage + 1;
          if (next > 5) next = 1;
          setActiveStage(next);
        }
      }, 3500); // 3.5 seconds
    }

    function stopAutoPlay() {
      clearInterval(autoPlayTimer);
    }

    // Event Listeners
    stageItems.forEach(item => {
      item.addEventListener('mouseenter', () => {
        isAutoPlaying = false;
        stopAutoPlay();
        setActiveStage(parseInt(item.dataset.stage, 10));
      });
      
      item.addEventListener('click', () => {
        isAutoPlaying = false;
        stopAutoPlay();
        setActiveStage(parseInt(item.dataset.stage, 10));
      });
    });

    // Resume autoplay when mouse leaves the left column area
    document.querySelector('.left-col').addEventListener('mouseleave', () => {
       isAutoPlaying = true;
       startAutoPlay();
    });

    // Init
    setActiveStage(1);
    startAutoPlay();
  </script>
</body>
</html>
